---
title: "営利とオープンソースの間で 〜 Embulk の場合"
emoji: "🧬️" # アイキャッチとして使われる絵文字（1文字だけ）
type: "idea" # tech: 技術記事 / idea: アイデア
topics: [ "embulk", "opensource", "OSS", "plugin" ]
layout: default
published: false
---

2023 年は (まだ数ヶ月残っていますが現時点でも) 企業とオープンソースの関係が難しくなった年であったように思います。

6 月には、フルタイムの Ruby コミッターとしてクックパッド社で研究開発を行っていたお二人が人員削減の影響を受けたことに端を発し、オープンソースによく関わってきた一部のソフトウェア・エンジニアを中心に、企業活動とオープンソースの関係についての議論がありました。

@[card](https://note.com/cookpad/n/nc1b63628422c)

@[card](https://note.com/ruiu/n/ndfcda9adb748)

@[card](https://knqyf263.hatenablog.com/entry/2023/06/07/175830)

さらに 8 月には HashiCorp 社が自社のオープンソース製品を Business Source License 1.1 (BSL) に変更して「オープンソース」ではなくしたことも話題になりました。

@[card](https://www.hashicorp.com/blog/hashicorp-adopts-business-source-license)

自社のソフトウェアを積極的にオープンソースとして公開している[時雨堂](https://shiguredo.jp/)さんも、自社がオープンソースとどのように向き合っているのかを文章化しています。

@[card](https://voluntas.medium.com/%E4%BC%81%E6%A5%AD-oss-%E3%82%92%E7%B6%99%E7%B6%9A%E9%96%8B%E7%99%BA%E3%81%99%E3%82%8B%E3%81%9F%E3%82%81%E3%81%AB%E3%82%84%E3%81%A3%E3%81%A6%E3%81%84%E3%82%8B%E3%81%93%E3%81%A8-c783be34ccde)

@[card](https://voluntas.medium.com/%E6%99%82%E9%9B%A8%E5%A0%82%E3%81%AF%E4%BD%95%E3%82%92%E3%81%97%E3%81%A6%E3%81%84%E3%82%8B%E4%BC%9A%E7%A4%BE%E3%81%AA%E3%81%AE%E3%81%8B-a32fbd5a746a)

@[card](https://voluntas.medium.com/business-source-license-1-1-8c83662568cb)

さて、筆者は ["Open Source is in our DNA"](https://www.treasuredata.com/opensource/) を謳う[トレジャーデータ](https://www.treasuredata.com/)という会社で、自社発の [Embulk](https://www.embulk.org/) というオープンソース・ソフトウェアのメンテナンスを原作者から引き継ぎ、かれこれ 5 〜 6 年ほどメンテナーをやっています。

本記事は、オープンソースを前面に出して活動してきた企業で業務としてそのメンテナーを務めてきた一社員、という視点から、共有できることがあるかもしれないと思って、ここ数年の経験をつらつらと書いてみたものです。

Embulk について
================

Embulk とプラグイン
--------------------

[Embulk](https://www.embulk.org/) は、トレジャーデータ共同創業者の古橋さんが 2015 年にオープンソースとして [^apache-license-2] リリースしたソフトウェアで、行列 (row-column) 形式の大きめのデータを、一括 (バルク) で、各種のデータ置き場から、別の各種のデータ置き場に、転送するためのものです。 (筆者は 2016 年にトレジャーデータに入社して、それから Embulk のメンテナンスに関わっています)

[^apache-license-2]: [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0) です。

@[card](https://frsyuki.hatenablog.com/entry/2015/02/16/080150)

この転送元と転送先の「各種」を実現するために Embulk は「プラグイン」型の設計になっています。

Amazon S3 からデータを転送するための [`embulk-input-s3`](https://github.com/embulk/embulk-input-s3) や、そこにあるファイルをパースするための各種 parser プラグインに始まり、転送先として MySQL や PostgreSQL に書き込むための [`embulk-output-mysql`, `embulk-output-postgresql`](https://github.com/embulk/embulk-output-jdbc) など、いろいろなプラグインが Embulk 本体 (`embulk-core`) とは別のパッケージとしてメンテナンス、公開されています。

実は Embulk は、本体だけではほぼなにもできません。実際にデータを読んだり書いたりするのはすべてプラグインです。 Embulk のプラグインは、一般的な「プラグイン」がそうであるような「追加オプション」ではなく、必須の存在です。つまり Embulk は、すべてにおいて「プラグインありき」のソフトウェアなのです。

エコシステムとトレジャーデータ
-------------------------------

これらプラグインは、すべてをトレジャーデータで開発したわけでも、メンテナンスしているわけでもありません。トレジャーデータ以外の方々もさまざまなプラグインを開発してオープンソースで公開してくださり、それらを含めた全体として Embulk という「エコシステム (生態系)」を形成しています。

社外の方々がリリースしてくれたプラグインをトレジャーデータの中でも使っていますし、さらに Embulk をトレジャーデータのお客様の環境で使っていただくようにお勧めすることもあり、その中で社外のプラグインを使っていただくこともあります。トレジャーデータは Embulk というエコシステムの「ユーザー」でもあるのです。

言い換えると、トレジャーデータは Embulk (本体) という「ソフトウェア」を最初に世に出した会社でありながら、「Embulk エコシステム」に対して絶対的なオーナーシップも実質的な「支配権」も持っていません。 2023 年 8 月現在 Embulk 本体の「コミット権」を持っているのはたしかにトレジャーデータの人間だけなのですが、たとえばそれを傘に来て無茶な変更を強行すれば、プラグインをメンテナンスしてくれている方々に見捨てられ、「Embulk エコシステム」はまるごと無価値になってしまうでしょう。

特に Embulk とプラグインの互換性にかかわる意思決定は、トレジャーデータを含めて、プラグインをメンテナンスしているゆるい「コミュニティ」の中で試行錯誤しながらなされていた、というのが実態です。

ただ正直なところ、この関係性を正しく理解していた人は社内にもほぼいません (でした) と言わざるをえません。 (今はそれなりに改善しました)

プラグインの互換性に影響するような変更の要望が社内から来ることはしばしばあるのですが [^requirements-from-inside] 「それは既存のプラグインとの互換性の問題があるので、コミュニティでも相談しないとならないし、すぐには実現できないですね」と答えると、「なんでコミュニティのことなんて気にしないとならないのか」「Embulk ってトレジャーデータのものじゃないの? なんですぐに変えられないの?」のような目を向けられることもしばしばでした。 [^faster-inside]

[^requirements-from-inside]: 要望があること自体は健全なことです。

[^faster-inside]: 同じエンジニアからも、「こう変えれば (社内のインフラが) 速くなるじゃん」と互換性ぶち壊しのゴリ押しをされそうになることもありました。

このような関係性は、ソフトウェア・エンジニアでもなく、オープンソースにも縁の浅い人からは理解しにくいでしょうし、それはしかたのない部分もあります。しかし「オープンソースは自分たちの DNA」と言い切る組織としては、社内の理解くらいはもう少し進めたいですね。

エコシステムそのものの維持
---------------------------

さて、このような Embulk エコシステムを維持していくためには、「Embulk 本体 (`embulk-core`) というソフトウェア」をただ粛々とメンテナンスしていればいいわけではありません。「エコシステム」自体・全体を維持するためのコストを (Embulk 本体のメンテナンスを通して) 誰かが払い続けなければなりません。 2023 年 8 月現在 Embulk 本体への「コミット権」を持っているのはトレジャーデータの人間だけなので、このコストを払えるのはトレジャーデータだけです。

ところで、トレジャーデータの中で最も Embulk を使っているのが "Data Connector" と呼ばれるサービスです。 @@@

@@@ 認知されていないものは評価もされようがないわけです。

@[card](https://techplay.jp/event/879660)

@[card](https://api-docs.treasuredata.com/blog/embulk-in-td/)

メンテナンス体制の変更
-----------------------

@[card](https://zenn.dev/dmikurube/articles/embulk-maintenance-gets-open)



インターフェースと依存関係
===========================

@[card](https://docs.google.com/presentation/d/e/2PACX-1vQf7dSmMDTBqQQgF-NcMqCssWv34BIVacK6_4xrMAIJnbqNXt65goIW0PhzfXIUSJf_SKgEmS5Ujqvo/pub?start=false&loop=false&slide=id.p)

明示的なインターフェース
-------------------------

暗黙のインターフェース
-----------------------


インターフェースの寿命
=======================

どんな会社のどんな組織にも、その組織の「悪いクセ」というのがあるものですよね。そのクセがその組織の強みの裏返しだったりもするので、一言で否定できるものでもありませんが。

さて、トレジャーデータのエンジニアリング組織にも、悪いクセがあります。筆者が思うに、その悪いクセの代表的なものが「内部・中身をそのまんま外部に露出させがち」というものです。

もちろん、そうしたがるのにも理由があります。その最たるものが「その方が効率的」というものです。「高速!」「柔軟!」「省力!」「サーバー費用を n% 下げられる!」とか言ったら、特にエンジニア的には大正義に思えますよね。

でも、それのみを基準に考えていると落とし穴があるかも、という話です。

Data Connector のインターフェース
----------------------------------

...


プラグイン・メカニズムの光と影
-------------------------------

...


寿命のズレ
-----------

ここで重要な学びはなんでしょうか。それは「ビジネスのインターフェース」の寿命と、「テクニカルなインターフェース」の寿命には、ズレがある、ということです。そして「オープンソースのインターフェース」の寿命ともなれば、ズレはさらに大きくなります。

...
